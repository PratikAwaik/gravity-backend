{"version":3,"sources":["components/Post/PostHeader.js","components/Post/PostFooter.js","components/Post/EditPost.js","configs/domPurifyConfig.js","components/Post/PostBody.js","components/Post/PostDetail.js"],"names":["PostHeader","post","className","to","subreddit","id","src","communityIcon","alt","prefixedName","user","username","moment","createdAt","fromNow","editedAt","PostFooter","isPostDetail","setToEdit","useSelector","state","currentUser","comments","history","useHistory","dispatch","useDispatch","hasUpvotedAlready","hasUpvotedAlreadyHelper","hasDownvotedAlready","hasDownvotedAlreadyHelper","handleDeletePost","a","swalObject","title","showCancelButton","showConfirmButton","confirmButtonText","cancelButtonText","position","icon","customClass","confirmButton","cancelButton","Swal","fire","isConfirmed","deletePostDispatcher","token","goBack","timer","errorPopup","onClick","handleUpvoteHelper","upvotes","handleDownvoteHelper","downvotes","length","EditPost","setPost","useState","content","editorState","setEditorState","useParams","handleSubmit","e","preventDefault","editPostDispatcher","successPopup","onSubmit","FancyEditor","editorContent","setEditorContent","isPost","type","domPurifyConfig","ADD_TAGS","ADD_ATTR","PostBody","toEdit","style","maskImage","WebkitMaskImage","window","localStorage","setItem","pageYOffset","dangerouslySetInnerHTML","__html","DOMPurify","sanitize","Comments","React","lazy","PostDetail","forums","iter","useRef","useEffect","find","current","getAllPostsDispatcher","replace","currentUserDetailsDispatcher","handleCreateComment","commentData","level","createCommentDispatcher","Suspense"],"mappings":"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","file":"static/js/7.387e3f83.chunk.js","sourcesContent":["import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport moment from \"moment\";\nimport PropTypes from \"prop-types\";\n\nconst PostHeader = ({ post }) => {\n  return (\n    <div className=\"forum-post-header text-theme-gray text-sm mb-2 flex flex-col sm:flex-row sm:items-center z-10\">\n      <Link\n        to={`/r/${post.subreddit.id}`}\n        className=\"flex items-center mr-2 hover:underline\"\n      >\n        <img\n          className=\"w-6 h-6 rounded-full mr-1\"\n          src={post.subreddit.communityIcon}\n          alt=\"Community Icon\"\n        />\n        <span className=\"font-bold\">{post.subreddit.prefixedName}</span>\n      </Link>\n      <div className=\"ml-5 sm:ml-0 flex flex-wrap items-center\">\n        Posted by\n        {post.user && post.user.username ? (\n          <Link to={`/user/${post.user.id}`} className=\"ml-1 hover:underline\">\n            {post.user.prefixedName}\n          </Link>\n        ) : (\n          <span className=\"ml-1 underline\">{\"u/[deleted]\"}</span>\n        )}\n        <div className=\"mx-2 inline-block w-1 h-1 bg-theme-black rounded-full\"></div>\n        {moment(post.createdAt).fromNow()}\n        {post.editedAt && <span className=\"ml-1\">(edited)</span>}\n      </div>\n    </div>\n  );\n};\n\nPostHeader.propTypes = {\n  post: PropTypes.object.isRequired,\n};\n\nexport default PostHeader;\n","import React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport PropTypes from \"prop-types\";\nimport Swal from \"sweetalert2\";\nimport {\n  errorPopup,\n  handleDownvoteHelper,\n  handleUpvoteHelper,\n  hasDownvotedAlreadyHelper,\n  hasUpvotedAlreadyHelper,\n} from \"../../helpers\";\nimport { deletePostDispatcher } from \"../../dispatchers/forums\";\n\nconst PostFooter = ({ post, isPostDetail, setToEdit }) => {\n  const { currentUser, comments } = useSelector((state) => state);\n  const history = useHistory();\n  const dispatch = useDispatch();\n\n  const hasUpvotedAlready = hasUpvotedAlreadyHelper(\n    currentUser,\n    post.id,\n    \"postsUpvoted\"\n  );\n  const hasDownvotedAlready = hasDownvotedAlreadyHelper(\n    currentUser,\n    post.id,\n    \"postsDownvoted\"\n  );\n\n  const handleUpvoteClick = () => {\n    handleUpvoteHelper(\n      dispatch,\n      currentUser,\n      post,\n      hasUpvotedAlready,\n      hasDownvotedAlready\n    );\n  };\n\n  const handleDownvoteClick = () => {\n    handleDownvoteHelper(\n      dispatch,\n      currentUser,\n      post,\n      hasUpvotedAlready,\n      hasDownvotedAlready\n    );\n  };\n\n  const toggleEdit = () => {\n    setToEdit(true);\n  };\n\n  const handleDeletePost = async () => {\n    const swalObject = {\n      title: \"Are you sure?\",\n      showCancelButton: true,\n      showConfirmButton: true,\n      confirmButtonText: \"Yes, delete it!\",\n      cancelButtonText: \"No, go back!\",\n      position: \"center\",\n      icon: \"warning\",\n      customClass: {\n        confirmButton:\n          \"bg-theme-green text-theme-white border border-theme-green rounded-md\",\n        cancelButton: \"bg-theme-gray, border border-theme-gray rounded-md\",\n      },\n    };\n\n    const result = await Swal.fire(swalObject);\n    if (result.isConfirmed) {\n      try {\n        await deletePostDispatcher(dispatch, post.id, currentUser.token);\n        history.goBack();\n        Swal.fire({\n          icon: \"success\",\n          title: \"Post deleted Successfully!\",\n          showConfirmButton: false,\n          timer: 2000,\n        });\n      } catch (err) {\n        errorPopup(err);\n      }\n    }\n  };\n\n  return (\n    <div\n      className={`forum-post-footer flex items-center justify-between ${\n        isPostDetail ? \"mb-5\" : \"\"\n      }`}\n    >\n      <div className=\"flex items-center\">\n        {currentUser.username ? (\n          <div\n            className={`mr-2 flex items-center ${\n              hasUpvotedAlready ? \"text-theme-green\" : \"\"\n            }`}\n          >\n            <i\n              className={`ri-rocket-2-${\n                hasUpvotedAlready ? \"fill\" : \"line\"\n              } cursor-pointer text-lg sm:text-xl z-10`}\n              onClick={handleUpvoteClick}\n            ></i>\n            <span className=\"text-xl\">{post.upvotes}</span>\n          </div>\n        ) : (\n          <Link to=\"/login\" className=\"mr-2 flex items-center\">\n            <i className=\"ri-rocket-2-line cursor-pointer text-lg sm:text-xl z-10\"></i>\n            <span className=\"text-xl\">{post.upvotes}</span>\n          </Link>\n        )}\n\n        {currentUser.username ? (\n          <div\n            className={`mr-4 flex items-center ${\n              hasDownvotedAlready ? \"text-theme-red\" : \"\"\n            }`}\n          >\n            <i\n              className={`ri-rocket-2-${\n                hasDownvotedAlready ? \"fill\" : \"line\"\n              } transform rotate-180 cursor-pointer text-lg sm:text-xl z-10`}\n              onClick={handleDownvoteClick}\n            ></i>\n            <span className=\"text-xl\">{post.downvotes}</span>\n          </div>\n        ) : (\n          <Link to=\"/login\" className=\"mr-4 flex items-center\">\n            <i className=\"ri-rocket-2-line transform rotate-180 cursor-pointer text-lg sm:text-xl z-10\"></i>\n            <span className=\"text-xl\">{post.downvotes}</span>\n          </Link>\n        )}\n\n        <div className=\"flex items-center cursor-pointer z-10\">\n          <i className=\"ri-chat-1-line mr-1 text-lg sm:text-xl\"></i>\n          <span className=\"mr-1\">\n            {isPostDetail ? comments.length : post.comments.length}\n          </span>\n          comments\n        </div>\n      </div>\n\n      {post.user && post.user.id === currentUser.id && isPostDetail && (\n        <div className=\"flex items-center mr-5\">\n          <button\n            to={`/forums/${post.id}/edit`}\n            onClick={toggleEdit}\n            className=\"mr-3\"\n          >\n            <i className=\"ri-edit-2-line cursor-pointer text-xl z-10 text-theme-blue\"></i>\n          </button>\n          <button onClick={handleDeletePost}>\n            <i className=\"ri-delete-bin-5-line cursor-pointer text-xl z-10 text-theme-red\"></i>\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nPostFooter.propTypes = {\n  post: PropTypes.object.isRequired,\n  isPostDetail: PropTypes.bool.isRequired,\n  setToEdit: PropTypes.func,\n};\n\nexport default PostFooter;\n","import React, { useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useParams } from \"react-router-dom\";\nimport FancyEditor from \"../Editors/FancyEditor\";\nimport { editPostDispatcher } from \"../../dispatchers/forums\";\nimport { successPopup } from \"../../helpers\";\n\nconst EditPost = ({ post, setPost, setToEdit }) => {\n  const [editorState, setEditorState] = useState(post.content);\n  const currentUser = useSelector((state) => state.currentUser);\n  const { id } = useParams();\n  const dispatch = useDispatch();\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    await editPostDispatcher(\n      dispatch,\n      id,\n      { content: editorState },\n      currentUser.token\n    );\n    setPost({ ...post, content: editorState });\n    await successPopup(\"Post updated successfully!\");\n    setToEdit(false);\n  };\n\n  return (\n    <div className=\"mt-5 create-post-container pt-9 max-w-3xl mx-auto mb-5\">\n      <form onSubmit={handleSubmit}>\n        <FancyEditor\n          editorContent={editorState}\n          setEditorContent={setEditorState}\n          isPost={true}\n        />\n\n        <div className=\"flex items-center mt-5\">\n          <button\n            type=\"submit\"\n            className=\"px-4 sm:px-5 py-1.5 border-2 border-theme-green rounded-md text-sm sm:text-base hover:bg-theme-green hover:text-theme-white\"\n          >\n            Update\n          </button>\n          <button\n            type=\"button\"\n            className=\"ml-4 px-4 sm:px-5 py-1.5 border-2 border-theme-red rounded-md text-sm sm:text-base hover:bg-theme-red\"\n            onClick={() => {\n              setToEdit(false);\n            }}\n          >\n            Cancel\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nEditPost.propTypes = {\n  post: PropTypes.object.isRequired,\n  setPost: PropTypes.func.isRequired,\n  setToEdit: PropTypes.func.isRequired,\n};\n\nexport default EditPost;\n","const domPurifyConfig = {\n  ADD_TAGS: [\"iframe\"],\n  ADD_ATTR: [\"allow\", \"allowfullscreen\", \"frameborder\", \"scrolling\"],\n};\n\nexport default domPurifyConfig;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport DOMPurify from \"dompurify\";\nimport PropTypes from \"prop-types\";\nimport EditPost from \"./EditPost\";\nimport domPurifyConfig from \"../../configs/domPurifyConfig\";\n\nconst PostBody = ({ post, setPost, isPostDetail, toEdit, setToEdit }) => {\n  const contentStyle = {\n    maskImage: \"linear-gradient(180deg, #000 70%, transparent)\",\n    WebkitMaskImage: \"linear-gradient(180deg, #000 70%, transparent)\",\n  };\n\n  const storeScrollPosition = () => {\n    window.localStorage.setItem(\"gravityScrollPosition\", window.pageYOffset);\n  };\n\n  return (\n    <div\n      className={`forum-post-body overflow-hidden mb-4 ${\n        !isPostDetail ? \"max-h-44 sm:max-h-52\" : \"\"\n      }`}\n      style={!isPostDetail ? contentStyle : {}}\n    >\n      {/* post content */}\n      {!isPostDetail ? (\n        <Link\n          to={`/forums/${post.id}`}\n          className=\"forum-post-body-title\"\n          onClick={storeScrollPosition}\n        >\n          <h3 className=\"text-lg sm:text-xl font-bold mb-3\">{post.title}</h3>\n        </Link>\n      ) : (\n        <div>\n          <h3 className=\"text-lg sm:text-xl font-bold mb-3\">{post.title}</h3>\n        </div>\n      )}\n\n      {/* edit post */}\n      {toEdit ? (\n        <EditPost post={post} setPost={setPost} setToEdit={setToEdit} />\n      ) : (\n        <div\n          className=\"text-sm sm:text-base forum-post-body-content\"\n          dangerouslySetInnerHTML={{\n            __html: DOMPurify.sanitize(post.content, domPurifyConfig),\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nPostBody.propTypes = {\n  post: PropTypes.object.isRequired,\n  setPost: PropTypes.func,\n  isPostDetail: PropTypes.bool.isRequired,\n  toEdit: PropTypes.bool,\n  setToEdit: PropTypes.func,\n};\n\nexport default PostBody;\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link, useParams, useHistory } from \"react-router-dom\";\nimport { createCommentDispatcher } from \"../../dispatchers/comments\";\nimport PostHeader from \"./PostHeader\";\nimport PostBody from \"./PostBody\";\nimport PostFooter from \"./PostFooter\";\nimport FancyEditor from \"../Editors/FancyEditor\";\nimport { currentUserDetailsDispatcher } from \"../../dispatchers/user\";\nimport { getAllPostsDispatcher } from \"../../dispatchers/forums\";\n\nconst Comments = React.lazy(() => import(\"../Comments/Comments\"));\n\nconst PostDetail = () => {\n  const [editorContent, setEditorContent] = useState(\"\");\n  const [post, setPost] = useState({});\n  const [toEdit, setToEdit] = useState(false);\n  const { id } = useParams();\n  const { currentUser, forums } = useSelector((state) => state);\n  const iter = useRef(0);\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  useEffect(() => {\n    (async function () {\n      if (\n        (forums.length === 0 || !forums.find((post) => post.id === id)) &&\n        iter.current < 1\n      ) {\n        await getAllPostsDispatcher(dispatch);\n        iter.current += 1;\n      } else {\n        const post = forums.find((post) => post.id === id);\n        if (post) {\n          setPost(post);\n        } else {\n          history.replace(\"/404\");\n        }\n      }\n    })();\n\n    return () => setPost({});\n  }, [dispatch, forums, id, history]);\n\n  useEffect(() => {\n    if (currentUser.id) currentUserDetailsDispatcher(dispatch);\n  }, [dispatch, currentUser.id]);\n\n  const handleCreateComment = async () => {\n    const commentData = {\n      content: editorContent,\n      level: 0,\n    };\n    await createCommentDispatcher(\n      dispatch,\n      post.id,\n      currentUser.token,\n      commentData\n    );\n    setEditorContent(\"\");\n  };\n\n  return post && post.id ? (\n    <div className=\"mt-20 sm:mt-24 mb-16 mx-auto max-w-4xl bg-transparent border-2 sm:rounded-md shadow-md post-detail-container\">\n      <div className=\"p-2 sm:p-4 post-detail-wrapper\">\n        <PostHeader post={post} />\n        <PostBody\n          post={post}\n          setPost={setPost}\n          isPostDetail={true}\n          toEdit={toEdit}\n          setToEdit={setToEdit}\n        />\n        <PostFooter\n          post={post}\n          isPostDetail={true}\n          toEdit={toEdit}\n          setToEdit={setToEdit}\n        />\n\n        {currentUser.username && (\n          <div className=\"post-detail-add-comment mb-5\">\n            <span className=\"block text-sm mb-3 text-theme-gray\">\n              Comment as\n              <Link className=\"ml-1 underline\" to={`/user/${currentUser.id}`}>\n                {currentUser.username}\n              </Link>\n            </span>\n\n            <FancyEditor\n              editorContent={editorContent}\n              setEditorContent={setEditorContent}\n              isPost={false}\n            />\n\n            <button\n              type=\"button\"\n              className=\"mt-2 px-4 py-1 border-2 border-theme-green text-sm sm:text-base rounded-md hover:bg-theme-green hover:text-theme-white\"\n              onClick={handleCreateComment}\n            >\n              Comment\n            </button>\n          </div>\n        )}\n\n        <hr />\n        <div className=\"my-4 post-detail-comments\">\n          <React.Suspense>\n            <Comments post={post} />\n          </React.Suspense>\n        </div>\n      </div>\n    </div>\n  ) : null;\n};\n\nexport default PostDetail;\n"],"sourceRoot":""}